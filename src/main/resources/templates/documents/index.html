<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title>Documents partagés</title>
</head>
<body>
    <div layout:fragment="content">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800">Documents partagés</h1>
            <button id="uploadBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-md shadow-sm flex items-center">
                <i class="fas fa-upload mr-2"></i>
                Partager un document
            </button>
        </div>

        <!-- Navigation and Search -->
        <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                <div class="flex items-center space-x-2">
                    <nav class="flex" aria-label="Breadcrumb">
                        <ol class="inline-flex items-center space-x-1">
                            <li class="inline-flex items-center">
                                <a href="#" class="text-gray-500 hover:text-indigo-600">
                                    <i class="fas fa-home"></i>
                                </a>
                            </li>
                            <li>
                                <div class="flex items-center">
                                    <i class="fas fa-chevron-right text-gray-400 text-xs mx-1"></i>
                                    <a href="#" class="text-gray-500 hover:text-indigo-600">Documents</a>
                                </div>
                            </li>
                            <li>
                                <div class="flex items-center">
                                    <i class="fas fa-chevron-right text-gray-400 text-xs mx-1"></i>
                                    <a href="#" class="text-indigo-600">Cours</a>
                                </div>
                            </li>
                        </ol>
                    </nav>
                </div>
                <div class="flex space-x-2">
                    <div class="relative">
                        <input type="text" placeholder="Rechercher des documents..." class="pl-10 pr-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                    </div>
                    <select class="border rounded-md px-3 py-2">
                        <option>Tous types</option>
                        <option>PDF</option>
                        <option>Documents</option>
                        <option>Images</option>
                        <option>Autres</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Folders -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                <div class="flex items-center space-x-3 mb-2">
                    <div class="bg-blue-100 p-3 rounded-lg">
                        <i class="fas fa-folder text-blue-600 text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-800">Cours</h3>
                </div>
                <div class="flex justify-between text-xs text-gray-500 mt-2">
                    <span>15 fichiers</span>
                    <span>Modifié il y a 3 jours</span>
                </div>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                <div class="flex items-center space-x-3 mb-2">
                    <div class="bg-green-100 p-3 rounded-lg">
                        <i class="fas fa-folder text-green-600 text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-800">TD / TP</h3>
                </div>
                <div class="flex justify-between text-xs text-gray-500 mt-2">
                    <span>23 fichiers</span>
                    <span>Modifié hier</span>
                </div>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                <div class="flex items-center space-x-3 mb-2">
                    <div class="bg-yellow-100 p-3 rounded-lg">
                        <i class="fas fa-folder text-yellow-600 text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-800">Examens</h3>
                </div>
                <div class="flex justify-between text-xs text-gray-500 mt-2">
                    <span>8 fichiers</span>
                    <span>Modifié il y a 1 semaine</span>
                </div>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                <div class="flex items-center space-x-3 mb-2">
                    <div class="bg-purple-100 p-3 rounded-lg">
                        <i class="fas fa-folder text-purple-600 text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-800">Projets</h3>
                </div>
                <div class="flex justify-between text-xs text-gray-500 mt-2">
                    <span>12 fichiers</span>
                    <span>Modifié il y a 2 jours</span>
                </div>
            </div>
        </div>

        <!-- Files -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="px-6 py-4 border-b">
                <div class="flex justify-between items-center">
                    <h2 class="text-lg font-semibold">Fichiers récents</h2>
                    <div class="flex space-x-2 text-sm">
                        <button class="flex items-center space-x-1 text-gray-600 hover:text-indigo-600">
                            <i class="fas fa-th"></i>
                            <span>Grille</span>
                        </button>
                        <button class="flex items-center space-x-1 text-indigo-600">
                            <i class="fas fa-list"></i>
                            <span>Liste</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Nom
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Propriétaire
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Date de modification
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Taille
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <i class="far fa-file-pdf text-red-500 text-lg mr-2"></i>
                                    <div>
                                        <div class="text-sm font-medium text-gray-900">Cours_Analyse_S4.pdf</div>
                                        <div class="text-xs text-gray-500">PDF</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <img class="h-6 w-6 rounded-full mr-2" src="https://ui-avatars.com/api/?name=Prof+Martin" alt="Prof Martin">
                                    <span class="text-sm text-gray-900">Prof. Martin</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                Il y a 2 jours
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                4.2 MB
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <div class="flex space-x-3">
                                    <button class="text-indigo-600 hover:text-indigo-800" title="Télécharger">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="text-gray-500 hover:text-gray-700" title="Partager">
                                        <i class="fas fa-share-alt"></i>
                                    </button>
                                    <button class="text-gray-500 hover:text-gray-700" title="Plus d'options">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <i class="far fa-file-word text-blue-500 text-lg mr-2"></i>
                                    <div>
                                        <div class="text-sm font-medium text-gray-900">Rapport_TP_Physique.docx</div>
                                        <div class="text-xs text-gray-500">DOCX</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <img class="h-6 w-6 rounded-full mr-2" src="https://ui-avatars.com/api/?name=Thomas+D" alt="Thomas D">
                                    <span class="text-sm text-gray-900">Thomas D.</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                Hier
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                1.8 MB
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <div class="flex space-x-3">
                                    <button class="text-indigo-600 hover:text-indigo-800" title="Télécharger">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="text-gray-500 hover:text-gray-700" title="Partager">
                                        <i class="fas fa-share-alt"></i>
                                    </button>
                                    <button class="text-gray-500 hover:text-gray-700" title="Plus d'options">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <i class="far fa-file-powerpoint text-orange-500 text-lg mr-2"></i>
                                    <div>
                                        <div class="text-sm font-medium text-gray-900">Présentation_Projet_Final.pptx</div>
                                        <div class="text-xs text-gray-500">PPTX</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <img class="h-6 w-6 rounded-full mr-2" src="https://ui-avatars.com/api/?name=Julie+P" alt="Julie P">
                                    <span class="text-sm text-gray-900">Julie P.</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                Il y a 3 jours
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                6.5 MB
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <div class="flex space-x-3">
                                    <button class="text-indigo-600 hover:text-indigo-800" title="Télécharger">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="text-gray-500 hover:text-gray-700" title="Partager">
                                        <i class="fas fa-share-alt"></i>
                                    </button>
                                    <button class="text-gray-500 hover:text-gray-700" title="Plus d'options">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <i class="far fa-file-excel text-green-500 text-lg mr-2"></i>
                                    <div>
                                        <div class="text-sm font-medium text-gray-900">Données_Statistiques.xlsx</div>
                                        <div class="text-xs text-gray-500">XLSX</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <img class="h-6 w-6 rounded-full mr-2" src="https://ui-avatars.com/api/?name=Sophie+M" alt="Sophie M">
                                    <span class="text-sm text-gray-900">Sophie M.</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                Il y a 1 semaine
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                2.1 MB
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <div class="flex space-x-3">
                                    <button class="text-indigo-600 hover:text-indigo-800" title="Télécharger">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="text-gray-500 hover:text-gray-700" title="Partager">
                                        <i class="fas fa-share-alt"></i>
                                    </button>
                                    <button class="text-gray-500 hover:text-gray-700" title="Plus d'options">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination -->
        <div class="mt-6 flex justify-between items-center">
            <div class="text-sm text-gray-500">
                Affichage de 1 à 4 sur 24 fichiers
            </div>
            <div class="flex space-x-1">
                <button class="px-3 py-1 rounded bg-gray-200 text-gray-600 hover:bg-gray-300 disabled:opacity-50" disabled>Précédent</button>
                <button class="px-3 py-1 rounded bg-indigo-600 text-white">1</button>
                <button class="px-3 py-1 rounded hover:bg-gray-200">2</button>
                <button class="px-3 py-1 rounded hover:bg-gray-200">3</button>
                <button class="px-3 py-1 rounded bg-gray-200 text-gray-600 hover:bg-gray-300">Suivant</button>
            </div>
        </div>

        <!-- Upload Modal -->
        <div id="uploadModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-medium">Partager un document</h3>
                    <button id="closeUploadModal" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Fichier(s)</label>
                        <div class="flex items-center justify-center border-2 border-gray-300 border-dashed rounded-md p-6">
                            <div class="space-y-1 text-center">
                                <i class="fas fa-cloud-upload-alt text-gray-400 text-3xl"></i>
                                <div class="flex flex-col text-sm text-gray-600">
                                    <label for="file-upload-modal" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none">
                                        <span>Télécharger un fichier</span>
                                        <input id="file-upload-modal" name="file-upload" type="file" class="sr-only" multiple>
                                    </label>
                                    <p class="pl-1">ou glisser-déposer</p>
                                </div>
                                <p class="text-xs text-gray-500">
                                    PNG, JPG, PDF, DOCX, PPTX, XLSX jusqu'à 20MB
                                </p>
                            </div>
                        </div>
                        <div id="upload-file-list" class="mt-2 text-sm text-gray-500"></div>
                    </div>

                    <div class="mb-4">
                        <label for="upload-folder" class="block text-sm font-medium text-gray-700 mb-1">Dossier de destination</label>
                        <select id="upload-folder" name="folder" 
                                class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Racine</option>
                            <option value="cours">Cours</option>
                            <option value="tp">TD / TP</option>
                            <option value="examens">Examens</option>
                            <option value="projets">Projets</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="upload-visibility" class="block text-sm font-medium text-gray-700 mb-1">Visibilité</label>
                        <select id="upload-visibility" name="visibility" 
                                class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="all">Tout le monde</option>
                            <option value="students">Tous les étudiants</option>
                            <option value="teachers">Tous les enseignants</option>
                            <option value="l1">L1 - Licence 1</option>
                            <option value="l2">L2 - Licence 2</option>
                            <option value="l3">L3 - Licence 3</option>
                            <option value="m1">M1 - Master 1</option>
                            <option value="m2">M2 - Master 2</option>
                            <option value="private">Privé (moi uniquement)</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label for="upload-description" class="block text-sm font-medium text-gray-700 mb-1">Description (optionnel)</label>
                        <textarea id="upload-description" name="description" rows="3" 
                                  class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                  placeholder="Décrivez brièvement le contenu de ce document..."></textarea>
                    </div>

                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancelUpload" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                            Annuler
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">
                            Partager
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // Modal functionality
        const uploadBtn = document.getElementById('uploadBtn');
        const uploadModal = document.getElementById('uploadModal');
        const closeUploadModal = document.getElementById('closeUploadModal');
        const cancelUpload = document.getElementById('cancelUpload');
        const fileUpload = document.getElementById('file-upload-modal');
        const fileList = document.getElementById('upload-file-list');
        
        if (uploadBtn && uploadModal && closeUploadModal && cancelUpload) {
            uploadBtn.addEventListener('click', function() {
                uploadModal.classList.remove('hidden');
            });
            
            closeUploadModal.addEventListener('click', function() {
                uploadModal.classList.add('hidden');
            });
            
            cancelUpload.addEventListener('click', function() {
                uploadModal.classList.add('hidden');
            });
            
            // Close when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === uploadModal) {
                    uploadModal.classList.add('hidden');
                }
            });
        }
        
        // Handle file uploads
        if (fileUpload && fileList) {
            fileUpload.addEventListener('change', function() {
                fileList.innerHTML = '';
                
                if (this.files && this.files.length > 0) {
                    for (let i = 0; i < this.files.length; i++) {
                        let file = this.files[i];
                        let size = (file.size / 1024).toFixed(1) + ' KB';
                        
                        if (file.size > 1024 * 1024) {
                            size = (file.size / (1024 * 1024)).toFixed(1) + ' MB';
                        }
                        
                        let icon = 'fa-file';
                        if (file.type.includes('pdf')) icon = 'fa-file-pdf';
                        else if (file.type.includes('word')) icon = 'fa-file-word';
                        else if (file.type.includes('excel') || file.type.includes('spreadsheet')) icon = 'fa-file-excel';
                        else if (file.type.includes('powerpoint') || file.type.includes('presentation')) icon = 'fa-file-powerpoint';
                        else if (file.type.includes('image')) icon = 'fa-file-image';
                        
                        let fileItem = document.createElement('div');
                        fileItem.className = 'flex items-center justify-between py-1';
                        fileItem.innerHTML = `
                            <div class="flex items-center">
                                <i class="far ${icon} text-indigo-500 mr-2"></i>
                                <span class="truncate max-w-xs">${file.name}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-xs text-gray-500 mr-2">${size}</span>
                                <button type="button" class="text-gray-400 hover:text-red-500 remove-file" data-index="${i}">
                                    <i class="fas fa-times-circle"></i>
                                </button>
                            </div>
                        `;
                        fileList.appendChild(fileItem);
                    }
                    
                    // Add event listeners to remove buttons
                    document.querySelectorAll('.remove-file').forEach(button => {
                        button.addEventListener('click', function() {
                            this.closest('div.flex.items-center.justify-between').remove();
                        });
                    });
                }
            });
        }
        
        // File drag and drop
        const dropArea = document.querySelector('.border-dashed');
        if (dropArea) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('border-indigo-300', 'bg-indigo-50');
            }
            
            function unhighlight() {
                dropArea.classList.remove('border-indigo-300', 'bg-indigo-50');
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (fileUpload) {
                    fileUpload.files = files;
                    const event = new Event('change', { bubbles: true });
                    fileUpload.dispatchEvent(event);
                }
            }
        }
    </script>
</body>
</html>
